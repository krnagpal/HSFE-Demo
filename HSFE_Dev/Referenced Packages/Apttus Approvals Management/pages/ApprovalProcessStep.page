<!-- 
    Apttus Approvals Management
    ApprovalProcessStep
     
    @2010-2014 Apttus Inc. All rights reserved.

 -->
<apex:page standardcontroller="Apttus_Approval__Approval_Process__c" 
           extensions="Apttus_Approval.ApprovalProcessStepController" 
           showHeader="true"
           sidebar="true" 
           tabStyle="Apttus_Approval__Approval_Process__c"> 
    
    <style>
        textarea {
            width: 40%;
        }
    </style>
        
    <!-- ADD mode -->
    <apex:sectionHeader title="{!$Label.apttus_approval__New & ' ' & $Label.apttus_approval__ApprovalProcessStep}" 
                        subtitle="{!businessObjectLabel & ': ' & parentProcessName}" 
                        rendered="{!IsAddMode && NOT(IsAddModeDone) && ISBLANK(Apttus_Approval__Approval_Process__c.Id)}" />

    <!-- ADD mode final step -->
    <apex:sectionHeader title="{!$Label.apttus_approval__ApprovalProcessFInalStep}" 
                        rendered="{!IsAddMode && IsAddModeDone}" />

    <!-- EDIT mode -->
    <apex:sectionHeader title="{!$Label.apttus_approval__Edit & ' ' & $Label.apttus_approval__ApprovalProcessStep}" 
                        subtitle="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Name__c}" 
                        rendered="{!IsEditMode && NOT(ISBLANK(Apttus_Approval__Approval_Process__c.Id))}" />
                        
    <!-- VIEW mode -->
    <apex:sectionHeader title="{!$Label.apttus_approval__View & ' ' & $Label.apttus_approval__ApprovalProcessStep}" 
                        subtitle="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Name__c}" 
                        rendered="{!IsViewMode && NOT(ISBLANK(Apttus_Approval__Approval_Process__c.Id))}" />

    <apex:includeScript value="{!URLFOR($Resource.Apttus_Approval__YUILibrary, '/yui/build/yahoo-dom-event/yahoo-dom-event.js')}" />
    <apex:includeScript value="{!URLFOR($Resource.Apttus_Approval__YUILibrary, '/yui/build/container/container-min.js')}" />
    <apex:includescript value="{!URLFOR($Resource.Apttus_Approval__YUILibrary, '/yui/build/dragdrop/dragdrop-min.js')}" />
    <apex:includescript value="{!URLFOR($Resource.Apttus_Approval__YUILibrary, '/yui/build/animation/animation-min.js')}" />
    <apex:includeScript value="{!URLFOR($Resource.Apttus_Approval__YUILibrary, '/yui/build/treeview/treeview-min.js')}" /> 
    <apex:includeScript value="{!URLFOR($Resource.Apttus_Approval__YUILibrary, '/yui/build/menu/menu-min.js')}" />
    <apex:includeScript value="{!URLFOR($Resource.Apttus_Approval__YUILibrary, '/yui/build/yahoo/yahoo-min.js')}" />

    <apex:stylesheet value="{!URLFOR($Resource.Apttus_Approval__YUILibrary, '/yui/build/assets/skins/sam/skin.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.Apttus_Approval__YUILibrary, '/yui/build/treeview/assets/skins/sam/treeview.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.Apttus_Approval__YUILibrary, '/yui/examples/treeview/assets/css/menu/tree.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.Apttus_Approval__YUILibrary, '/yui/build/menu/assets/skins/sam/menu.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.Apttus_Approval__YUILibrary, '/yui/build/container/assets/skins/sam/container.css')}" />

    <script type="text/javascript">
    
        // Create a namespace for our custom functions
        YAHOO.namespace("force.com");
        
        /**
         * Builds the wait panel.
         */
           YAHOO.force.com.buildWaitPanel = function() {
               document.body.className = document.body.className + " yui-skin-sam";
               YAHOO.force.com.waitPanel = new YAHOO.widget.Panel(
                   "waitPanel",  // The id of our dialog container
                   { 
                           width           :   "300px", // You can play with this until it's right
                           visible         :   false,   // Should be invisible when rendered
                           draggable       :   false,   // Make the dialog draggable
                           close           :   false,   // Don't include a close title button
                           modal           :   true,    // Make it modal
                           fixedCenter     :   true,    // Keep centered if window is scrolled
                           zindex          :   40,      // Make sure it's on top of everything
                           constraintoviewport: true,
                           
                           // This line adds the appear/disapper fade effect
                           effect           :   {effect:YAHOO.widget.ContainerEffect.FADE,duration:0.25}
                                        
                   }
               );
               
               // header
               YAHOO.force.com.waitPanel.setHeader("Please Wait");
            
               // set image
               YAHOO.force.com.waitPanel.setBody('<center><img src="{!URLFOR($Resource.Apttus_Approval__Image_LoadingPage)}" /></center>');
               // Render the dialog to the document.body level of the DOM
               YAHOO.force.com.waitPanel.render(document.body);
           }
            
        /**
         * Callback when the action button is clicked
         */
        function onActionClick() {
        
            // show the modal panel
            YAHOO.force.com.waitPanel.show();
            
            // return false to allow the action to proceed
            return false;
        }
        
        /**
         * Callback when the action is completed
         */
        function onActionComplete() {
        
            // hide the modal panel
            YAHOO.force.com.waitPanel.hide();
        }
        
        YAHOO.force.com.onDOMReady = function() {
            
            // add our custom skin css to the body tag
            document.body.className = document.body.className + " yui-skin-sam";                    
            
            // build the wait panel
            YAHOO.force.com.buildWaitPanel();
        }   
        
        // build the tree as soon as the DOM is in a usable state
        YAHOO.util.Event.onDOMReady(YAHOO.force.com.onDOMReady);
        
    </script>

    <apex:form id="idApprovalProcessStepForm">
        
        <!--  required process fields -->
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Name}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Active__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Description__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Object_Name__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Object_Label__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Object_Type__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Process_Name__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.RecordTypeId}" rendered="false" />
        
        <!--  required step group fields -->
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Group__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Group_Action_Field_Name_Source__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Group_Action_Field_Name__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Group_Action_Field_Update_Type__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Group_Action_Field_Value__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Group_Action_Type__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Group_Action__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Group_Active__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Group_Name__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Group_Rejection_Action__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Group_Seq_Number__c}" rendered="false" />

        <!--  required step fields -->
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepSequence__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Active__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Approver_Type__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Assignee_Description__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Assignee_Type__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Assignee__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Hierarchy_Driver__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Name__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Notify_Only__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Auto_Complete__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Seq_Number__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Send_Email__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__DependsOn__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepFilterLogic__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepAutoEscalate__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepExpectedDaysToComplete__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepExpectedHoursToComplete__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepExpectedMinutesToComplete__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepEscalateToType__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepEscalateToName__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepEscalateToId__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepSubmissionCommentsEnabled__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepSubmissionComment1Enabled__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepSubmissionComment2Enabled__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepSubmissionComment3Enabled__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepLabel__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepType__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__ChildObjectType__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__CriteriaFieldNames__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepAutoReapprove__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepAutoReapprovalCriteria__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepDisplayFieldNames__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepKeyFieldNames__c}" rendered="false" />

        <!--  required step filter fields -->
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Filter__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Filter_Field_Object_Source__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Filter_Field_Object__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Filter_Field__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Filter_Comparison_Type__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Filter_Field_Value__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Filter_Comments__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Filter_BoolOper__c}" rendered="false" />
		
		<!--  required step auto reapproval filter fields -->
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__CriteriaFieldNames__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepAutoReapprove__c}" rendered="false" />
        <apex:outputText value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepAutoReapprovalCriteria__c}" rendered="false" />
        
        <!--
            ADD/EDIT mode
        
            step 1 - Step Information
            step 2 - Step Entry Criteria
            step 3 - Step Auto-Reapproval Criteria
            step 4 - Step Dependencies
            step 5 - Assigned Approvers
            step 6 - Escalated Approver
            step 7 - Step Submission Comments
            step 8 - Step Display Field Names
        -->
        <apex:pageBlock id="idApprovalProcessStepBlock" 
                        title="{!IF(NOT(IsViewMode), $Label.apttus_approval__Step & ' ' & TEXT(currentStep) & ': ' & currentStepName, '')}"
                        rendered="{!((IsAddMode && NOT(IsAddModeDone)) || IsEditMode) && NOT(inSearchMode)}"
                        mode="edit">
                        
            <apex:pageMessages />
            
            <apex:pageBlockButtons location="both">
                <apex:commandButton value="{!$Label.apttus_approval__Previous}" 
                                    action="{!doPrevious}"
                                    rendered="{!(IsAddMode && (currentStep > 1) && NOT(IsAddModeDone)) ||
                                                (isEditMode && (currentStep > 1))}"
                                    reRender="idApprovalProcessStepForm"
                                    status="idPleaseWait" />
                                                
                <apex:commandButton value="{!$Label.apttus_approval__Next}" 
                                    action="{!doNext}"
                                    rendered="{!NOT(isLastStep)}"
                                    reRender="idApprovalProcessStepForm"
                                    status="idPleaseWait" />

                <apex:commandButton value="{!$Label.apttus_approval__Save}" 
                                    action="{!doSave}"
                                    rendered="{!(IsAddMode && isLastStep) || isEditMode}"
                                    reRender="idApprovalProcessStepForm"
                                    status="idPleaseWait" />
                                    
                <apex:commandButton value="{!$Label.apttus_approval__Cancel}"
                                    action="{!doCancel}"
                                    immediate="true"
                                    reRender="idApprovalProcessStepForm"
                                    status="idPleaseWait" />

                <apex:actionStatus id="idPleaseWait">
                    <apex:facet name="start">
                        {!$Label.apttus_approval__StatusPleaseWait}...
                        <img src="/apexpages/devmode/img/saveStatus.gif" />
                    </apex:facet>
                    <apex:facet name="stop" />
                </apex:actionStatus>
            </apex:pageBlockButtons>
            
            <!-- Step 1 - Step Information -->
            <apex:pageBlockSection columns="1" rendered="{!currentStep == 1}">
                {!$Label.apttus_approval__ApprovalProcessStep1Inst}
            </apex:pageBlockSection>

            <apex:pageBlockSection id="idProcessStepInfoSection" 
                                   title="{!$Label.apttus_approval__ApprovalProcessStepName}" 
                                   columns="1" 
                                   collapsible="false" 
                                   rendered="{!currentStep == 1}">
                
                <!-- step name -->
                <apex:pageBlockSectionItem id="idStepNameItem">
                    <apex:outputLabel for="idStepName" value="{!$Label.apttus_approval__StepName}" />
                    <apex:outputPanel styleClass="requiredInput" layout="block">
                        <apex:outputPanel styleClass="requiredBlock" layout="block"/>
                        <apex:inputField id="idStepName"
                                         value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Name__c}"
                                         style="width:500px;">
                            <apex:actionSupport event="onchange"
                                                action="{!doStepNameChanged}"
                                                reRender="idProcessStepInfoSection"
                                                status="idStatusWaitStepName" />
                        </apex:inputField>
                        <apex:actionStatus id="idStatusWaitStepName">
                            <apex:facet name="start">
                                {!$Label.apttus_approval__StatusPleaseWait}...
                                <img src="/apexpages/devmode/img/saveStatus.gif" />
                            </apex:facet>
                            <apex:facet name="stop" />
                        </apex:actionStatus>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <!-- step label -->
                <apex:pageBlockSectionItem id="idStepLabelItem">
                    <apex:outputLabel for="idStepLabel" value="{!$Label.apttus_approval__StepLabel}" />
                    <apex:outputPanel styleClass="requiredInput" layout="block">
                        <apex:outputPanel styleClass="requiredBlock" layout="block"/>
                        <apex:inputField id="idStepLabel"
                                         value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepLabel__c}"
                                         style="width:500px;" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <!-- step type -->
                <apex:pageBlockSectionItem id="idStepTypeItem" rendered="{!currentStep == 1}">
                    <apex:outputLabel for="idStepType" value="{!$Label.apttus_approval__StepType}" />
                    <apex:outputPanel styleClass="requiredInput" layout="block">
                        <apex:outputPanel styleClass="requiredBlock" layout="block" />
                        <apex:inputField id="idStepType" value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepType__c}">
                            <apex:actionSupport event="onchange"
                                                action="{!doStepTypeChanged}"
                                                reRender="idProcessStepInfoSection"
                                                status="idStatusWaitStepType" />
                        </apex:inputField>
                        <apex:actionStatus id="idStatusWaitStepType">
                            <apex:facet name="start">
                                {!$Label.apttus_approval__StatusPleaseWait}...
                                <img src="/apexpages/devmode/img/saveStatus.gif" />
                            </apex:facet>
                            <apex:facet name="stop" />
                        </apex:actionStatus>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <!-- child context object type -->
                <apex:pageBlockSectionItem rendered="{!isStepTypeChildProcess}" >
                    <apex:outputLabel for="idContextObject" value="{!$Label.apttus_approval__ContextObject}" />
                    <apex:outputPanel styleClass="requiredInput" layout="block">
						<apex:outputPanel styleClass="requiredBlock" layout="block"/>
						<apex:selectList id="idContextObject" size="1"
						                 value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__ChildObjectType__c}" >
                            <apex:selectOptions value="{!childObjectTypes}"></apex:selectOptions>
							<apex:actionSupport event="onchange"
							                    action="{!doContextObjectChanged}"
							                    reRender="idProcessStepInfoSection"
							                    status="idPleaseWaitContextObject" />
						</apex:selectList>
						<apex:actionStatus id="idPleaseWaitContextObject">
						    <apex:facet name="start">
						        {!$Label.apttus_approval__StatusPleaseWait}...
						        <img src="/apexpages/devmode/img/saveStatus.gif" />
						    </apex:facet>
						    <apex:facet name="stop" />
						</apex:actionStatus>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <!-- approval rule -->
	            <apex:pageBlockSectionItem id="idAssigneeTypeRuleItem"
	                                       rendered="{!isStepTypeSubprocess || isStepTypeChildProcess}">
	                <apex:outputLabel value="{!$Label.apttus_approval__ApprovalRule}" />
	                <apex:outputPanel styleClass="requiredInput" layout="block">                 
                        <apex:outputPanel styleClass="requiredBlock" layout="block"/>
                        <apex:inputText value="{!assigneeName}" size="30"
                                        disabled="{!isReadOnly}"/>  
                        <apex:commandLink action="{!doSelectRule}"
                                          rendered="{!NOT(isReadOnly)}"
                                          type="image/gif"
                                          reRender="idApprovalProcessStepForm"
                                          status="idPleaseWaitStatusRule">
                            <apex:image value="/img/s.gif" styleClass="lookupIcon"/>
                        </apex:commandLink>
                        <apex:actionStatus id="idPleaseWaitStatusRule">
                            <apex:facet name="start">
                                {!$Label.apttus_approval__StatusPleaseWait}...
                                <img src="/apexpages/devmode/img/saveStatus.gif" />
                            </apex:facet>
                            <apex:facet name="stop" />
                        </apex:actionStatus>
                        <apex:inputText value="{!assigneeId}" style="visibility:hidden;" />  
	                </apex:outputPanel>
	            </apex:pageBlockSectionItem>

                <!-- step description -->
                <apex:pageBlockSectionItem >
                    <apex:outputLabel for="idStepDesc" value="{!$Label.apttus_approval__StepDescription}" />
                    <apex:outputPanel layout="block">
                        <apex:inputField id="idStepDesc" 
                                         value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Description__c}" 
                                         style="width:500px;" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <!-- active -->
                <!--<apex:pageBlockSectionItem id="idStepActive"
                                           helpText="{!$ObjectType.Approval_Process__c.Fields.Step_Active__c.inlineHelpText}"
                                           rendered="{!isStepTypeSubprocess || isStepTypeChildProcess}">
                    <apex:outputLabel value="{!$ObjectType.Approval_Process__c.Fields.Step_Active__c.Label}" />
                    <apex:inputCheckbox value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Active__c}"
                                        disabled="{!isReadOnly}" />
                </apex:pageBlockSectionItem>-->
            </apex:pageBlockSection>
            
            <!-- Step 2 - Step Entry Criteria -->
            <apex:pageBlockSection columns="1" rendered="{!currentStep == 2}">
                {!$Label.apttus_approval__ApprovalProcessStep2Inst}
            </apex:pageBlockSection>
                
            <apex:pageBlockSection id="idStepFilterCriteriaSectionEdit" 
                                   title="{!$Label.apttus_approval__ApprovalProcessStepFilterCriteria}" 
                                   columns="2" 
                                   collapsible="false"
                                   rendered="{!currentStep == 2}">
                                   
                <apex:pageBlockTable value="{!predicates}" 
                                     var="predicate" 
                                     columns="14"
                                     rowClasses="oddRow,evenRow">
                    
                    <!-- 1. rownum -->
                    <apex:column rendered="{!isAdvancedOptionsMode}" >
                        <apex:outputText id="idRowNum" value="{!predicate.RowNum}. " />
                    </apex:column>
                    
                    <!-- 2. use LHS child search filter? -->
                    <apex:column >
                        <apex:facet name="header">
                            <apex:outputText >{!$Label.apttus_approval__UseLHS}<br/>{!$Label.apttus_approval__Filter}</apex:outputText>
                        </apex:facet>
                        <apex:outputPanel styleClass="{!IF(predicate.FieldInError, 'errorRow', '')}" layout="block" >
                            <apex:inputCheckbox id="idUseLHSChildFilter" value="{!predicate.UseLHSChildFilter}">      
                                <apex:actionSupport event="onchange"
                                                    action="{!predicate.doUseLHSChildFilterChanged}"
                                                    reRender="idStepFilterCriteriaSectionEdit"
                                                    status="idStatusWaitUseLHSChildFilter" />
                            </apex:inputCheckbox>
                            <apex:actionStatus id="idStatusWaitUseLHSChildFilter" startText="{!$Label.apttus_approval__StatusPleaseWait}..." />
                        </apex:outputPanel>
                    </apex:column>
                    
                    <!-- 3. LHS child search filter name -->
                    <apex:column >
                        <apex:facet name="header">
                            <apex:outputText >{!$Label.apttus_approval__LHS} {!$Label.apttus_approval__Child}<br/>{!$Label.apttus_approval__Filter}</apex:outputText>
                        </apex:facet>
                        <apex:outputPanel rendered="{!predicate.UseLHSChildFilter}"
                                          styleClass="{!IF(predicate.FieldInError, 'errorRow', '')}" layout="block" >
                            <apex:selectList id="idLHSChildFilterName" size="1" value="{!predicate.LHSChildFilterName}" >
                                <apex:selectOptions value="{!childSearchFilterItems}"></apex:selectOptions>
                                <apex:actionSupport event="onchange"
                                                    action="{!predicate.doLHSChildFilterNameChanged}"
                                                    reRender="idStepFilterCriteriaSectionEdit" 
                                                    status="idStatusWaitLHSChildFilterName" />
                            </apex:selectList>
                            <apex:actionStatus id="idStatusWaitLHSChildFilterName" startText="{!$Label.apttus_approval__StatusPleaseWait}..." />
                        </apex:outputPanel>
                    </apex:column>
                    
                    <!-- 4. LHS child object field -->
                    <apex:column >
                        <apex:facet name="header">
                            <apex:outputText >{!$Label.apttus_approval__LHS} {!$Label.apttus_approval__Child}<br/> {!$Label.apttus_approval__Filter} {!$Label.apttus_approval__Field}</apex:outputText>
                        </apex:facet>
                        <apex:outputPanel rendered="{!predicate.UseLHSChildFilter}"
                                          styleClass="{!IF(predicate.FieldInError, 'errorRow', '')}" layout="block" >
                            <apex:selectList id="idChildObjectField" size="1" value="{!predicate.FieldName}" >
                                <apex:selectOptions value="{!predicate.LHSChildObjectFieldItems}"></apex:selectOptions>
                            </apex:selectList>
                        </apex:outputPanel>
                    </apex:column>
                    
                    <!-- 5. business object field -->
                    <apex:column headerValue="{!$Label.apttus_approval__Field}">
                        <apex:outputPanel rendered="{!NOT(predicate.UseLHSChildFilter)}"
                                          styleClass="{!IF(predicate.FieldInError, 'errorRow', '')}" layout="block" >
                            <apex:selectList id="idBusObjectField" size="1" value="{!predicate.FieldName}" >
                                <apex:selectOptions value="{!fieldItems}"></apex:selectOptions>
                                <apex:actionSupport event="onchange"
                                                    action="{!predicate.doFieldNameChanged}"
                                                    reRender="idStepFilterCriteriaSectionEdit" 
                                                    status="idStatusWaitFieldName" />
                            </apex:selectList>
                            <apex:actionStatus id="idStatusWaitFieldName" startText="{!$Label.apttus_approval__StatusPleaseWait}..." />
                        </apex:outputPanel>
                    </apex:column>

                    <!-- 6. operator -->
                    <apex:column headerValue="{!$Label.apttus_approval__Operator}" >
                        <!-- comparison operator rendered for picklists since we need to check for 
                             supporting in with multiple values -->
                        <apex:outputPanel rendered="{!predicate.FieldType == 'PICKLIST'}"
                                          styleClass="{!IF(predicate.CompOperInError, 'errorRow', '')}" layout="block" >
                            <apex:selectList id="idCompOperPicklist" size="1"
                                             value="{!predicate.CompOper}" >
                                <apex:selectOptions value="{!compOperItems}"></apex:selectOptions>
                                <apex:actionSupport event="onchange"
                                                    action="{!predicate.doCompOperChanged}"
                                                    reRender="idStepFilterCriteriaSectionEdit"
                                                    status="idStatusWaitCompOperChanged" />
                            </apex:selectList>
                            <apex:actionStatus id="idStatusWaitCompOperChanged" startText="{!$Label.apttus_approval__StatusPleaseWait}..." />
                        </apex:outputPanel>
                        
                        <!-- comparison operator rendered for everything else but picklists -->
                        <apex:outputPanel rendered="{!NOT(predicate.FieldType == 'PICKLIST')}"
                                          styleClass="{!IF(predicate.CompOperInError, 'errorRow', '')}" layout="block" >
                            <apex:selectList id="idCompOper" size="1"
                                             value="{!predicate.CompOper}" >
                                <apex:selectOptions value="{!compOperItems}"></apex:selectOptions>
                            </apex:selectList>
                        </apex:outputPanel>
                    </apex:column>

                    <!-- 7. use RHS child search filter? -->
                    <apex:column >
                        <apex:facet name="header">
                            <apex:outputText >{!$Label.apttus_approval__UseRHS}<br/>{!$Label.apttus_approval__Filter}</apex:outputText>
                        </apex:facet>
                        <apex:outputPanel styleClass="{!IF(predicate.FieldInError, 'errorRow', '')}" layout="block" >
                            <apex:inputCheckbox id="idUseRHSChildFilter" value="{!predicate.UseRHSChildFilter}">      
                                <apex:actionSupport event="onchange"
                                                    action="{!predicate.doUseRHSChildFilterChanged}"
                                                    reRender="idStepFilterCriteriaSectionEdit"
                                                    status="idStatusWaitUseRHSChildFilter" />
                            </apex:inputCheckbox>
                            <apex:actionStatus id="idStatusWaitUseRHSChildFilter" startText="{!$Label.apttus_approval__StatusPleaseWait}..." />
                        </apex:outputPanel>
                    </apex:column>
                    
                    <!-- 8. RHS child search filter name -->
                    <apex:column >
                        <apex:facet name="header">
                            <apex:outputText >{!$Label.apttus_approval__RHS} {!$Label.apttus_approval__Child}<br/>{!$Label.apttus_approval__Filter}</apex:outputText>
                        </apex:facet>
                        <apex:outputPanel rendered="{!predicate.UseRHSChildFilter}"
                                          styleClass="{!IF(predicate.FieldInError, 'errorRow', '')}" layout="block" >
                            <apex:selectList id="idRHSChildFilterName" size="1" value="{!predicate.RHSChildFilterName}" >
                                <apex:selectOptions value="{!childSearchFilterItems}"></apex:selectOptions>
                                <apex:actionSupport event="onchange"
                                                    action="{!predicate.doRHSChildFilterNameChanged}"
                                                    reRender="idStepFilterCriteriaSectionEdit" 
                                                    status="idStatusWaitRHSChildFilterName" />
                            </apex:selectList>
                            <apex:actionStatus id="idStatusWaitRHSChildFilterName" startText="{!$Label.apttus_approval__StatusPleaseWait}..." />
                        </apex:outputPanel>
                    </apex:column>

                    <!-- 9. RHS child object value -->
                    <apex:column >
                        <apex:facet name="header">
                            <apex:outputText >{!$Label.apttus_approval__RHS} {!$Label.apttus_approval__Child}<br/>{!$Label.apttus_approval__Filter} {!$Label.apttus_approval__Field}</apex:outputText>
                        </apex:facet>
                        <apex:outputPanel rendered="{!predicate.UseRHSChildFilter}"
                                          styleClass="{!IF(predicate.FieldInError, 'errorRow', '')}" layout="block" >
                            <apex:selectList id="idRHSChildObjectField" size="1" value="{!predicate.FieldValue}" >
                                <apex:selectOptions value="{!predicate.RHSChildObjectFieldItems}"></apex:selectOptions>
                            </apex:selectList>
                        </apex:outputPanel>
                    </apex:column>

                    <!-- 10. business object value -->
                    <apex:column headerValue="{!$Label.apttus_approval__Value}">
                        <apex:outputPanel rendered="{!NOT(predicate.UseRHSChildFilter) &&
                                                      predicate.FieldType == 'PICKLIST' &&
                                                      (predicate.CompOper == 'in' || predicate.CompOper == 'not in')}"
                                          styleClass="{!IF(predicate.FieldValueInError, 'errorRow', '')}" layout="block">
                            <apex:selectList id="idPicklistMultiFieldValue" 
                                             value="{!predicate.FieldValues}" 
                                             multiselect="true" 
                                             required="false" 
                                             size="5" >
                                <apex:selectOptions value="{!predicate.FieldValueOptions}" />
                            </apex:selectList>
                        </apex:outputPanel>
                        <apex:outputPanel rendered="{!NOT(predicate.UseRHSChildFilter) &&
                                                      predicate.FieldType == 'PICKLIST' &&
                                                      NOT(predicate.CompOper == 'in') &&
                                                      NOT(predicate.CompOper == 'not in')}"
                                          styleClass="{!IF(predicate.FieldValueInError, 'errorRow', '')}" layout="block">
                            <apex:selectList id="idPicklistFieldValue" 
                                             value="{!predicate.FieldValue}" 
                                             multiselect="false" 
                                             required="false" 
                                             size="1" >
                                <apex:selectOptions value="{!predicate.FieldValueOptions}" />
                            </apex:selectList>
                        </apex:outputPanel>
                        <apex:outputPanel rendered="{!NOT(predicate.UseRHSChildFilter) &&
                                                      predicate.FieldType == 'MULTIPICKLIST'}"
                                          styleClass="{!IF(predicate.FieldValueInError, 'errorRow', '')}" layout="block">
                            <apex:selectList id="idMultiPicklistFieldValue" 
                                             value="{!predicate.FieldValues}" 
                                             multiselect="true" 
                                             required="false" 
                                             size="5" >
                                <apex:selectOptions value="{!predicate.FieldValueOptions}"></apex:selectOptions>
                            </apex:selectList>
                        </apex:outputPanel>
                        <apex:outputPanel rendered="{!NOT(predicate.UseRHSChildFilter) &&
                                                      predicate.FieldType != 'PICKLIST' &&
                                                      predicate.FieldType != 'MULTIPICKLIST'}"
                                          styleClass="{!IF(predicate.FieldValueInError, 'errorRow', '')}" layout="block">
                            <apex:inputText id="idTextFieldValue" size="25"
                                            value="{!predicate.FieldValue}" 
                                            rendered="{!NOT(predicate.UseCustomValue)}" />
                            <apex:outputText value="{!$Label.apttus_approval__NotApplicable}" style="width:60px" 
                                             rendered="{!predicate.UseCustomValue}" />
                        </apex:outputPanel>
                    </apex:column>

                    <!-- 11. custom -->
                    <apex:column headerValue="{!$Label.apttus_approval__Custom}" >
                        <apex:outputPanel rendered="{!NOT(predicate.UseLHSChildFilter ||
                                                          predicate.UseRHSChildFilter)}">
                            <apex:inputCheckbox id="idUseCustomValue"
                                                value="{!predicate.UseCustomValue}">      
                                <apex:actionSupport event="onchange"
                                                    action="{!predicate.doUseCustomValueChanged}"
                                                    reRender="idStepFilterCriteriaSectionEdit"
                                                    status="idStatusWaitFilterCriteria" />
                            </apex:inputCheckbox>
                            <apex:actionStatus id="idStatusWaitFilterCriteria" startText="{!$Label.apttus_approval__StatusPleaseWait}..." />
                        </apex:outputPanel>
                    </apex:column>
                    
                    <!-- 12. custom value expression -->
                    <apex:column headerValue="{!$Label.apttus_approval__CustomValueExpression}" colspan="1" >
                        <apex:pageBlockTable value="{!dummyItems}" 
                                             var="dummyItem" 
                                             columns="5"
                                             rowClasses="oddRow,evenRow"
                                             rendered="{!predicate.UseCustomValue}">
                                     
                            <!-- use free form custom expression? -->
                            <apex:column headerValue="{!$Label.apttus_approval__CustomValueExpressionUseFreeForm}">
                                <apex:outputPanel >
                                    <apex:inputCheckbox id="idCustomValueUseFreeFormExpr"
                                                        value="{!predicate.UseCustomValueFreeFormExpr}">      
                                        <apex:actionSupport event="onchange"
                                                            action="{!predicate.doCustomValueFreeFormTextChanged}"
                                                            reRender="idStepFilterCriteriaSectionEdit"
                                                            status="idStatusWaitCustomValueFreeForm" />
                                    </apex:inputCheckbox>
                                    <apex:actionStatus id="idStatusWaitCustomValueFreeForm" startText="{!$Label.apttus_approval__StatusPleaseWait}..." />
                                </apex:outputPanel>
                            </apex:column>

                            <!-- free form custom expression -->
                            <apex:column headerValue="{!$Label.apttus_approval__FieldValue}"
                                         rendered="{!predicate.UseCustomValueFreeFormExpr}">
                                <apex:outputPanel >                            
                                    <apex:inputText id="idCustomValueExpr" size="110"
                                                    value="{!predicate.CustomValueExpr}" />
                                </apex:outputPanel>
                            </apex:column>

                            <!-- custom object -->
                            <apex:column headerValue="{!$Label.apttus_approval__Object}"
                                         rendered="{!NOT(predicate.UseCustomValueFreeFormExpr)}">
                                <apex:outputPanel styleClass="{!IF(predicate.FieldInError, 'errorRow', '')}" layout="block" >
                                    <apex:selectList id="idCustomValueObject" size="1"
                                                     value="{!predicate.customValueObject}" >
                                        <apex:selectOptions value="{!predicate.customValueObjects}"></apex:selectOptions>
                                        <apex:actionSupport event="onchange"
                                                            action="{!predicate.doCustomValueObjectChanged}"
                                                            reRender="idStepFilterCriteriaSectionEdit"
                                                            status="idStatusWaitFieldValueObject" />
                                    </apex:selectList>
                                    <apex:actionStatus id="idStatusWaitFieldValueObject" startText="{!$Label.apttus_approval__StatusPleaseWait}..." />
                                </apex:outputPanel>
                            </apex:column>
        
                            <!-- custom field -->
                            <apex:column headerValue="{!$Label.apttus_approval__Field}"
                                         rendered="{!NOT(predicate.UseCustomValueFreeFormExpr)}">
                                <apex:outputPanel styleClass="{!IF(predicate.FieldInError, 'errorRow', '')}" layout="block" >
                                    <apex:selectList id="idFieldValueField" size="1"
                                                     value="{!predicate.customValueObjectField}" >
                                        <apex:selectOptions value="{!predicate.customValueObjectFields}"></apex:selectOptions>
                                    </apex:selectList>
                                </apex:outputPanel>
                            </apex:column>
        
                            <!-- custom filter expression -->
                            <apex:column headerValue="{!$Label.apttus_approval__FilterExpression}"
                                         colspan="1" rowspan="3"
                                         rendered="{!NOT(predicate.UseCustomValueFreeFormExpr)}">
                                <apex:outputPanel >                            
                                    <apex:selectList id="idFilterExprField" size="1"
                                                     value="{!predicate.CustomValueObjectFilterField}" >
                                        <apex:selectOptions value="{!predicate.customValueObjectFields}"></apex:selectOptions>
                                    </apex:selectList>
                                    <br/>
                                    <apex:selectList id="idFilterExprCompOper" size="1"
                                                     value="{!predicate.CustomValueObjectFilterCompOper}" >
                                        <apex:selectOptions value="{!customObjectCompOperItems}"></apex:selectOptions>
                                    </apex:selectList>
                                    <br/>
                                    <apex:selectList id="idFilterExprFieldValueBound" size="1"                       
                                                     value="{!predicate.CustomValueObjectFilterValue}" 
                                                     rendered="{!predicate.BindCustomFilterValue}">
                                        <apex:selectOptions value="{!customObjectBindFieldItems}"></apex:selectOptions>
                                    </apex:selectList>
                                    <apex:inputText id="idFilterExprFieldValue" size="25"
                                                    value="{!predicate.CustomValueObjectFilterValue}" 
                                                    rendered="{!NOT(predicate.BindCustomFilterValue)}" />
                                </apex:outputPanel>
                            </apex:column>
        
                            <!-- bind value? -->
                            <apex:column headerValue="{!$Label.apttus_approval__BindValue}"
                                         rendered="{!NOT(predicate.UseCustomValueFreeFormExpr)}">
                                <apex:outputPanel >
                                    <apex:inputCheckbox id="idFilterExprBindCustomFilterValue"
                                                        value="{!predicate.BindCustomFilterValue}">      
                                        <apex:actionSupport event="onchange"
                                                            reRender="idStepFilterCriteriaSectionEdit"
                                                            status="idStatusWaitCustomQueue" />
                                    </apex:inputCheckbox>
                                    <apex:actionStatus id="idStatusWaitCustomQueue" startText="{!$Label.apttus_approval__StatusPleaseWait}..." />
                                </apex:outputPanel>
                            </apex:column>

                        </apex:pageBlockTable>
                    </apex:column>

                    <!-- 13. join/add -->
                    <apex:column rendered="{!NOT(isAdvancedOptionsMode)}">        
                        <apex:outputText id="idBoolOper" 
                                         value="{!predicate.BoolOper}" 
                                         rendered="{!NOT(isAdvancedOptionsMode) && NOT(ISBLANK(predicate.BoolOper))}" />
                        <apex:commandLink action="{!doAddRow}" 
                                          reRender="idStepFilterCriteriaSectionEdit,
                                                    idStepFilterCriteriaAdvancedOptionsEdit" 
                                          rendered="{!NOT(isAdvancedOptionsMode) && ISBLANK(predicate.BoolOper)}"
                                          status="idPleaseWaitAddRow" > 
                            <apex:image url="{!$Resource.Apttus_Approval__Image_Plus2}" 
                                        title="{!$Label.apttus_approval__Add}" 
                                        alt="{!$Label.apttus_approval__Add}" />                
                        </apex:commandLink>
		                <apex:actionStatus id="idPleaseWaitAddRow">
		                    <apex:facet name="start">
		                        {!$Label.apttus_approval__StatusPleaseWait}...
		                        <img src="/apexpages/devmode/img/saveStatus.gif" />
		                    </apex:facet>
		                    <apex:facet name="stop" />
		                </apex:actionStatus>
                    </apex:column>

                    <!-- 14. delete row -->
                    <apex:column >
                        <apex:commandLink id="idDeleteRow" 
                                          action="{!doDeleteRow}" 
                                          reRender="idStepFilterCriteriaSectionEdit,
                                                    idStepFilterCriteriaAdvancedOptionsEdit" 
                                          rendered="{!predicate.RowNum > 1}" 
                                          status="idPleaseWaitDeleteRow">
                            <apex:param name="rowNum" value="{!predicate.RowNum}" />    
                            <apex:image url="{!$Resource.Apttus_Approval__Image_Minus2}" 
                                        title="{!$Label.apttus_approval__Remove}" 
                                        alt="{!$Label.apttus_approval__Remove}" />     
                        </apex:commandLink>
                        <apex:actionStatus id="idPleaseWaitDeleteRow">
                            <apex:facet name="start">
                                {!$Label.apttus_approval__StatusPleaseWait}...
                                <img src="/apexpages/devmode/img/saveStatus.gif" />
                            </apex:facet>
                            <apex:facet name="stop" />
                        </apex:actionStatus>
                    </apex:column>
                    
                    <!-- 15. error indicator -->
                    <apex:column rendered="{!NOT(predicate.ErrorMsg == null)}">
                        <apex:outputText value="{!predicate.ErrorMsg}" style="color:red;" />
                    </apex:column>
                   
                </apex:pageBlockTable>
            </apex:pageBlockSection>

            <!-- Advanced Options -->
            <apex:pageBlockSection id="idStepFilterCriteriaAdvancedOptionsEdit"
                                   columns="1"
                                   collapsible="false"
                                   rendered="{!currentStep == 2}" >
                                   
                <apex:actionStatus id="idPleaseWaitAdvOptions">
                    <apex:facet name="start">
                        {!$Label.apttus_approval__StatusPleaseWait}...
                        <img src="/apexpages/devmode/img/saveStatus.gif" />
                    </apex:facet>
                    <apex:facet name="stop" />
                </apex:actionStatus>
                
                <apex:commandLink id="idShowAdvancedOptions" 
                                  action="{!doShowAdvancedOptions}" 
                                  value="{!$Label.apttus_approval__AdvancedOptions}" 
                                  reRender="idStepFilterCriteriaAdvancedOptionsEdit,
                                            idStepFilterCriteriaSectionEdit" 
                                  rendered="{!NOT(isAdvancedOptionsMode)}" 
                                  status="idPleaseWaitAdvOptions" />
                
                <apex:outputPanel rendered="{!isAdvancedOptionsMode}">
                    <apex:commandLink id="idAddRow" 
                                      action="{!doAddRow}" 
                                      value="{!$Label.apttus_approval__AddRow}" 
                                      reRender="idStepFilterCriteriaAdvancedOptionsEdit,
                                                idStepFilterCriteriaSectionEdit" 
                                      status="idPleaseWaitAdvOptions" />
                    <span>  </span>
                    <apex:commandLink id="idRemoveRow" 
                                      action="{!doRemoveRow}" 
                                      value="{!$Label.apttus_approval__RemoveRow}" 
                                      reRender="idStepFilterCriteriaAdvancedOptionsEdit,
                                                idStepFilterCriteriaSectionEdit" 
                                      rendered="{!OkToRemoveRow}"
                                      status="idPleaseWaitAdvOptions" />
                                      
                    <apex:outputPanel id="idRemoveRow2" styleClass="greyedLink" rendered="{!NOT(OkToRemoveRow)}" >Remove Row</apex:outputPanel>
                    <p/>    
                    <apex:commandLink id="idHideAdvancedOptions" 
                                      action="{!doHideAdvancedOptions}" 
                                      value="{!$Label.apttus_approval__ClearAdvancedOptions}" 
                                      reRender="idStepFilterCriteriaAdvancedOptionsEdit,
                                                idStepFilterCriteriaSectionEdit" 
                                      status="idPleaseWaitAdvOptions" />
                    <br/>
                    <apex:outputText value="{!$Label.apttus_approval__AdvancedFilterCondition}" />
                    <br/>
                    <apex:inputText id="idAdvancedOptions" size="80" value="{!advancedOptions}" />
                </apex:outputPanel>
            </apex:pageBlockSection>
                    
            <!-- Step Filter Condition Description -->
            <apex:pageBlockSection id="idStepFilterConditionDescriptionEdit"
                                   columns="1"
                                   collapsible="false"
                                   rendered="{!isStepTypeStandard && currentStep == 2}" >
                                   
                <apex:outputPanel >
                    <apex:outputText value="{!$Label.apttus_approval__ConditionDescription}" />
                    <br/>
                    <apex:inputTextArea id="idStepFilterConditionDesc"
                                        value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepFilterConditionDescription__c}" 
                                        style="width:550px;height:40px" />
                </apex:outputPanel>
            </apex:pageBlockSection>

            <!-- Step 3 - Step Auto-Reapproval Criteria -->
            <apex:pageBlockSection columns="1" rendered="{!isStepTypeStandard && currentStep == 3}">
                {!$Label.apttus_approval__ApprovalProcessStep3Inst}
            </apex:pageBlockSection>

            <apex:pageBlockSection id="idStepAutoReapprovalSectionEdit" 
                                   columns="1" 
                                   collapsible="false" 
                                   rendered="{!isStepTypeStandard && currentStep == 3}" >
                
		        <!-- Reapproval Filter -->
                <c:UIReapprovalFilter id="idReapprovalFilter"  
				    				  sObjectName="{!businessObjectType}"  
				    				  pageController="{!this}" 
				    				  mode="wizard" />

            </apex:pageBlockSection>

            <!-- Step 4 - Step Dependencies -->
            <apex:pageBlockSection columns="1" rendered="{!(isStepTypeStandard && currentStep == 4) ||
                                                           (isStepTypeSubprocess && currentStep == 3) ||
                                                           (isStepTypeChildProcess && currentStep == 3)}">
                {!$Label.apttus_approval__ApprovalProcessStep4Inst}
            </apex:pageBlockSection>

            <apex:pageBlockSection id="idStepDependenciesSectionEdit" 
                                   columns="1" 
                                   collapsible="false" 
                                   rendered="{!(isStepTypeStandard && currentStep == 4) ||
                                               (isStepTypeSubprocess && currentStep == 3) ||
                                               (isStepTypeChildProcess && currentStep == 3)}">
                
                <c:UIDependsOn id="idDependsOn" 
                               pageControllerAttr="{!this}"
                               contextSOAttr="{!Apttus_Approval__Approval_Process__c}"
                               contextSOFieldAttr="DependsOn__c"
                               contextSOLabelAttr="Approval Process Step"
                               itemValuesAttr="{!dependsOnValues}" />
                
            </apex:pageBlockSection>

            <!-- Step 5 - Assigned Approvers -->
            <apex:pageBlockSection columns="1" rendered="{!isStepTypeStandard && currentStep == 5}">
                {!$Label.apttus_approval__ApprovalProcessStep5Inst}
            </apex:pageBlockSection> 

            <apex:pageBlockSection id="idStepApproverSection"
                                   columns="1"
                                   collapsible="false" 
                                   rendered="{!IsStepTypeStandard && currentStep == 5}">

                <apex:pageBlockSectionItem id="idStepAssigneeAutoComplete"
                                           helpText="{!$Label.apttus_approval__AssigneeAutoCompleteHelp}"
                                           rendered="{!showAutoCompleteInput}">
                    <apex:outputLabel value="{!$ObjectType.Apttus_Approval__Approval_Process__c.Fields.Apttus_Approval__Step_Auto_Complete__c.Label}" />
                    <apex:inputCheckbox value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Auto_Complete__c}"
                                        disabled="{!isReadOnly}" />
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>

            <apex:pageBlockSection id="idStepApproverSectionEdit" 
                                   columns="1" 
                                   collapsible="false" 
                                   rendered="{!IsStepTypeStandard && currentStep == 5}" >
                
                <c:UIAssignee id="idAssigneeType" 
                              pageControllerAttr="{!this}"
                              contextSOAttr="{!Apttus_Approval__Approval_Process__c}"
                              contextSOLabelAttr="{!$ObjectType.Apttus_Approval__Approval_Process__c.Label}"
                              isReadOnlyAttr="false"
                              businessObjTypeAttr="{!businessObjectType}"
                              assigneeTypeFieldAttr="Step_Assignee_Type__c"
                              assigneeValueFieldAttr="Step_Assignee__c"
                              assigneeIdFieldAttr="Step_Assignee_Id__c"
                              assigneeDescFieldAttr="Step_Assignee_Description__c"
                              assigneeSendEmailFieldAttr="Send_Email__c"
                              assigneeNotifyOnlyFieldAttr="Step_Notify_Only__c"
                              assigneeAttr="{!assignee}"
                              supportedAssigneeTypesAttr="{!supportedAssigneeTypes}"
                              parentReRenderIdAttr="idApprovalProcessStepForm" />
                
            </apex:pageBlockSection>

            <!-- Step 6 - Escalated Approver -->
            <apex:pageBlockSection columns="1" rendered="{!isStepTypeStandard && currentStep == 6}">
                {!$Label.apttus_approval__ApprovalProcessStep6Inst}
            </apex:pageBlockSection> 

            <apex:pageBlockSection id="idStepEscalationApproverSection"
                                   columns="1"
                                   collapsible="false" 
                                   rendered="{!isStepTypeStandard && currentStep == 6}">

                <apex:pageBlockSectionItem id="idStepEscalationAutoEscalate"
                                           helpText="{!$ObjectType.Apttus_Approval__Approval_Process__c.Fields.Apttus_Approval__StepAutoEscalate__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Apttus_Approval__Approval_Process__c.Fields.Apttus_Approval__StepAutoEscalate__c.Label}" />
                    <apex:outputPanel layout="block" >
                        <apex:outputPanel layout="block" />
                            <apex:inputCheckbox value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepAutoEscalate__c}">
                                <apex:actionSupport event="onchange"
                                                    action="{!doAutoEscalateChanged}"
                                                    reRender="idStepEscalationApproverSectionEdit"
                                                    status="idStatusWaitAutoEscalate" />
                            </apex:inputCheckbox>
                            <apex:actionStatus id="idStatusWaitAutoEscalate" startText="{!$Label.apttus_approval__StatusPleaseWait}..." />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem id="idStepEscalationExpectedDaysToComplete"
                                           helpText="{!$ObjectType.Apttus_Approval__Approval_Process__c.Fields.Apttus_Approval__StepExpectedDaysToComplete__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Apttus_Approval__Approval_Process__c.Fields.Apttus_Approval__StepExpectedDaysToComplete__c.Label}" />
                    <apex:inputField value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepExpectedDaysToComplete__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem id="idStepEscalationExpectedHoursToComplete"
                                           helpText="{!$ObjectType.Apttus_Approval__Approval_Process__c.Fields.Apttus_Approval__StepExpectedHoursToComplete__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Apttus_Approval__Approval_Process__c.Fields.Apttus_Approval__StepExpectedHoursToComplete__c.Label}" />
                    <apex:inputField value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepExpectedHoursToComplete__c}"/>
                </apex:pageBlockSectionItem>

            </apex:pageBlockSection>
            <apex:pageBlockSection id="idStepEscalationApproverSectionEdit" 
                                   columns="1" 
                                   collapsible="false" 
                                   rendered="{!isStepTypeStandard && currentStep == 6}" >
                
                <c:UIEscalationAssignee id="idEscalationAssigneeType" 
										pageControllerAttr="{!this}"
										contextSOAttr="{!Apttus_Approval__Approval_Process__c}"
										contextSOLabelAttr="{!$ObjectType.Apttus_Approval__Approval_Process__c.Label}"
										isReadOnlyAttr="false"
										businessObjTypeAttr="{!businessObjectType}"
										isAutoEscalateEnabledAttr="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepAutoEscalate__c}"
										assigneeTypeFieldAttr="StepEscalateToType__c"
										assigneeValueFieldAttr="StepEscalateToName__c"
										assigneeIdFieldAttr="StepEscalateToId__c"
										supportedAssigneeTypesAttr="{!supportedEscalationAssigneeTypes}"
										parentReRenderIdAttr="idApprovalProcessStepForm" />
                
            </apex:pageBlockSection>

            <!-- Step 7 - Step Submission Comments -->
            <apex:pageBlockSection columns="1" rendered="{!NOT(isStepLevelSubmissionCommentsEnabled) &&
                                                          ((isStepTypeStandard && currentStep == 7) ||
                                                          (isStepTypeSubprocess && currentStep == 4) ||
                                                          (isStepTypeChildProcess && currentStep == 4))}">
                {!$Label.apttus_approval__ApprovalProcessStep7Inst}<br/><br/>
                <b>{!$Label.apttus_approval__ApprovalProcessStep7aInst}</b>
            </apex:pageBlockSection>
            
            <apex:pageBlockSection columns="1" rendered="{!(isStepLevelSubmissionCommentsEnabled) &&
                                                          ((isStepTypeStandard && currentStep == 7) ||
                                                          (isStepTypeSubprocess && currentStep == 4) ||
                                                          (isStepTypeChildProcess && currentStep == 4))}">
                {!$Label.apttus_approval__ApprovalProcessStep7Inst}
            </apex:pageBlockSection> 

            <apex:pageBlockSection id="idStepSubmissionCommentsEnableSection"
                                   columns="1"
                                   collapsible="false" 
                                   rendered="{!(isStepLevelSubmissionCommentsEnabled) &&
                                               ((isStepTypeStandard && currentStep == 7) ||
                                                (isStepTypeSubprocess && currentStep == 4) ||
                                                (isStepTypeChildProcess && currentStep == 4))}">

                <!-- enable step level submission comments for this step -->
                <apex:pageBlockSectionItem id="idStepSubmissionCommentsEnabled"
                                           helpText="{!$ObjectType.Apttus_Approval__Approval_Process__c.Fields.Apttus_Approval__StepSubmissionCommentsEnabled__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Apttus_Approval__Approval_Process__c.Fields.Apttus_Approval__StepSubmissionCommentsEnabled__c.Label}" />
                    <apex:outputPanel layout="block" >
                        <apex:actionRegion >
                            <apex:inputField value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepSubmissionCommentsEnabled__c}">
                                <apex:actionSupport event="onchange"
                                                    action="{!doSubmissionCommentsEnableChanged}"
                                                    reRender="idApprovalProcessStepForm"
                                                    status="idStatusWaitEnableComments" />
                            </apex:inputField>
                            <apex:actionStatus id="idStatusWaitEnableComments">
                                <apex:facet name="start">
                                    {!$Label.apttus_approval__StatusPleaseWait}...
                                    <img src="/apexpages/devmode/img/saveStatus.gif" />
                                </apex:facet>
                                <apex:facet name="stop" />
                            </apex:actionStatus>
                        </apex:actionRegion>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>

            <!-- enable individual step level submission comments for this step -->
            <apex:pageBlockSection id="idStepSubmissionCommentEnableSection"
                                   columns="1"
                                   collapsible="false"
                                   title="{!$Label.apttus_approval__StepSubmissionComments}"
                                   rendered="{!(isStepLevelSubmissionCommentsEnabled) &&
                                               ((isStepTypeStandard && currentStep == 7) ||
                                                (isStepTypeSubprocess && currentStep == 4) ||
                                                (isStepTypeChildProcess && currentStep == 4))}">

                <!-- enable step level submission comment 1 for this step -->
                <apex:pageBlockSectionItem id="idStepSubmissionComment1Enabled"
                                           rendered="{!numSubmissionCommentsPerStep >= 1}"
                                           helpText="{!$ObjectType.Apttus_Approval__Approval_Process__c.Fields.Apttus_Approval__StepSubmissionComment1Enabled__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Apttus_Approval__Approval_Process__c.Fields.Apttus_Approval__StepSubmissionComment1Enabled__c.Label}" />
                    <apex:outputPanel id="idStepComment2EnabledPanel" layout="block" >
                        <apex:actionRegion >
                            <apex:inputField value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepSubmissionComment1Enabled__c}">
                                <apex:actionSupport event="onchange"
                                                    action="{!doSubmissionCommentEnableChanged}"
                                                    reRender="idApprovalProcessStepForm"
                                                    status="idStatusWaitEnableComments1" />
                            </apex:inputField>
                            <apex:outputText >{!$Label[submissionComment1Label]}</apex:outputText>
                            &nbsp;&nbsp;
                            <apex:actionStatus id="idStatusWaitEnableComments1">
                                <apex:facet name="start">
                                    {!$Label.apttus_approval__StatusPleaseWait}...
                                    <img src="/apexpages/devmode/img/saveStatus.gif" />
                                </apex:facet>
                                <apex:facet name="stop" />
                            </apex:actionStatus>
                        </apex:actionRegion>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <!-- enable step level submission comment 2 for this step -->
                <apex:pageBlockSectionItem id="idStepSubmissionComment2Enabled"
                                           rendered="{!numSubmissionCommentsPerStep >= 2}"
                                           helpText="{!$ObjectType.Apttus_Approval__Approval_Process__c.Fields.Apttus_Approval__StepSubmissionComment2Enabled__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Apttus_Approval__Approval_Process__c.Fields.Apttus_Approval__StepSubmissionComment2Enabled__c.Label}" />
                    <apex:outputPanel id="idStepComment2EnabledPanel" layout="block" >
                        <apex:actionRegion >
                            <apex:inputField value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepSubmissionComment2Enabled__c}">
                                <apex:actionSupport event="onchange"
                                                    action="{!doSubmissionCommentEnableChanged}"
                                                    reRender="idApprovalProcessStepForm"
                                                    status="idStatusWaitEnableComments2" />
                            </apex:inputField>
                            <apex:outputText >{!$Label[submissionComment2Label]}</apex:outputText>
                            &nbsp;&nbsp;
                            <apex:actionStatus id="idStatusWaitEnableComments2">
                                <apex:facet name="start">
                                    {!$Label.apttus_approval__StatusPleaseWait}...
                                    <img src="/apexpages/devmode/img/saveStatus.gif" />
                                </apex:facet>
                                <apex:facet name="stop" />
                            </apex:actionStatus>
                        </apex:actionRegion>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <!-- enable step level submission comment 3 for this step -->
                <apex:pageBlockSectionItem id="idStepSubmissionComment3Enabled"
                                           rendered="{!numSubmissionCommentsPerStep == 3}"
                                           helpText="{!$ObjectType.Apttus_Approval__Approval_Process__c.Fields.Apttus_Approval__StepSubmissionComment3Enabled__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Apttus_Approval__Approval_Process__c.Fields.Apttus_Approval__StepSubmissionComment3Enabled__c.Label}" />
                    <apex:outputPanel id="idStepComment3EnabledPanel" layout="block" >
                        <apex:actionRegion >
                            <apex:inputField value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepSubmissionComment3Enabled__c}">
                                <apex:actionSupport event="onchange"
                                                    action="{!doSubmissionCommentEnableChanged}"
                                                    reRender="idApprovalProcessStepForm"
                                                    status="idStatusWaitEnableComments3" />
                            </apex:inputField>
                            <apex:outputText >{!$Label[submissionComment3Label]}</apex:outputText>
                            &nbsp;&nbsp;
                            <apex:actionStatus id="idStatusWaitEnableComments3">
                                <apex:facet name="start">
                                    {!$Label.apttus_approval__StatusPleaseWait}...
                                    <img src="/apexpages/devmode/img/saveStatus.gif" />
                                </apex:facet>
                                <apex:facet name="stop" />
                            </apex:actionStatus>
                        </apex:actionRegion>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

            </apex:pageBlockSection>

            <!-- Step 8 - Step Display Field Names -->
            <apex:pageBlockSection columns="1" rendered="{!(isStepTypeStandard && currentStep == 8) ||
                                                           (isStepTypeSubprocess && currentStep == 5) ||
                                                           (isStepTypeChildProcess && currentStep == 5)}">
                {!$Label.apttus_approval__ApprovalProcessStep8Inst}
            </apex:pageBlockSection>

            <!-- display field names for standard and subprocess types -->
            <apex:pageBlockSection id="idStepDisplayStandardFieldNames" 
                                   columns="1" 
                                   collapsible="false" 
                                   rendered="{!(isStepTypeStandard && currentStep == 8) ||
                                               (isStepTypeSubprocess && currentStep == 5)}">

                <c:UIDisplayFieldNames id="idDisplayFieldNames" 
									   pageControllerAttr="{!this}"
									   contextSOAttr="{!Apttus_Approval__Approval_Process__c}"
									   contextSOFieldAttr="StepDisplayFieldNames__c"
									   contextSOLabelAttr="{!businessObjectType}"
									   itemValuesAttr="{!displayFieldNameValues}" />
            </apex:pageBlockSection>

            <!-- display field names for child process types -->
            <apex:pageBlockSection id="idStepDisplayChildProcessFieldNames" 
                                   columns="1" 
                                   collapsible="false" 
                                   rendered="{!(isStepTypeChildProcess && currentStep == 5)}">

                <c:UIDisplayFieldNames id="idDisplayFieldNames" 
                                       pageControllerAttr="{!this}"
                                       contextSOAttr="{!Apttus_Approval__Approval_Process__c}"
                                       contextSOFieldAttr="StepDisplayFieldNames__c"
                                       contextSOLabelAttr="{!childObjectType}"
                                       itemValuesAttr="{!displayFieldNameValues}" />
            </apex:pageBlockSection>

        </apex:pageBlock> 

        <!--
            ADD mode final step
        -->
        
        <!-- What Would You Like To Do Now? -->
        <apex:pageBlock id="idApprovalProcessStepNextStepBlock" 
                        rendered="{!IsAddMode && IsAddModeDone && NOT(inSearchMode)}">
                        
            <apex:pageBlockButtons location="bottom">
                <apex:commandButton id="idProcessNextStepButton" value="Go" action="{!doProcessNextStep}" />   
            </apex:pageBlockButtons>

            <apex:pageBlockSection id="idProcessNextStepSection" 
                                   columns="1" 
                                   collapsible="false" >

                <apex:outputLabel value="{!$Label.apttus_approval__ApprovalProcessStepNextConfirmation}"
                                  for="idNextStepSelected" />
                <br/>
                <apex:selectRadio id="idNextStepSelected"
                                  value="{!processNextStep}"
                                  layout="pageDirection">
                    <apex:selectOption itemValue="createStep"
                                       itemLabel="{!$Label.apttus_approval__ApprovalProcessCreateStepNow}"/>
                    <apex:selectOption itemValue="navigateDetail"
                                       itemLabel="{!$Label.apttus_approval__ApprovalProcessCreateStepLaterDetail}"/>
                    <apex:selectOption itemValue="navigateTab"
                                       itemLabel="{!$Label.apttus_approval__ApprovalProcessCreateStepLaterList}"/>
                </apex:selectRadio>
            </apex:pageBlockSection>
        </apex:pageBlock> 

        <!--
            VIEW mode
        -->
        
        <!-- Process Step Detail -->
        <apex:pageBlock id="idStepBlock" 
                        title="{!$Label.apttus_approval__View & ' ' & $Label.apttus_approval__ApprovalProcessStep}" 
                        rendered="{!IsViewMode && NOT(inSearchMode)}">
            <apex:pageMessages />
            
            <apex:pageBlockButtons location="both">
                <apex:commandButton value="{!$Label.apttus_approval__Edit}" action="{!doEditStep}" />
                <apex:commandButton value="{!$Label.apttus_approval__Cancel}" action="{!doCancel}" immediate="true" />
            </apex:pageBlockButtons>
            
           <!-- Step Information -->
           <apex:pageBlockSection id="idStepBlockSection" 
                                   title="{!$Label.apttus_approval__ApprovalProcessStepName}" 
                                   columns="1" 
                                   collapsible="false" >
                
                <!-- step name -->
                <apex:pageBlockSectionItem >
                    <apex:outputLabel for="idStepName" value="{!$Label.apttus_approval__StepName}" />
                    <apex:outputField id="idStepName" value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Name__c}" />
                </apex:pageBlockSectionItem>

                <!-- step label -->
                <apex:pageBlockSectionItem >
                    <apex:outputLabel for="idStepLabel" value="{!$Label.apttus_approval__StepLabel}" />
                    <apex:outputField id="idStepLabel" value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepLabel__c}" />
                </apex:pageBlockSectionItem>

                <!-- step type -->
                <apex:pageBlockSectionItem >
                    <apex:outputLabel for="idStepType" value="{!$Label.apttus_approval__StepType}" />
                    <apex:outputField id="idStepType" value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepType__c}" />
                </apex:pageBlockSectionItem>

                <!-- context object -->
                <apex:pageBlockSectionItem rendered="{!isStepTypeStandard || isStepTypeSubprocess}" >
                    <apex:outputLabel for="idContextObject" value="{!$Label.apttus_approval__ContextObject}" />
                    <apex:outputText id="idContextObject" value="{!businessObjectLabel}" />
                </apex:pageBlockSectionItem>
                
                <!-- child context object type -->
                <apex:pageBlockSectionItem rendered="{!isStepTypeChildProcess}" >
                    <apex:outputLabel for="idChildContextObject" value="{!$Label.apttus_approval__Child & ' ' & $Label.apttus_approval__ContextObject}" />
                    <apex:selectList id="idChildContextObject"
                                     value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__ChildObjectType__c}" 
                                     size="1"
                                     disabled="true">
                        <apex:selectOptions value="{!childObjectTypes}"></apex:selectOptions>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <!-- approval rule -->
                <apex:pageBlockSectionItem rendered="{!isStepTypeSubprocess || isStepTypeChildProcess}">
                    <apex:outputLabel for="idApprovalRule" value="{!$Label.apttus_approval__ApprovalRule}" />
                    <apex:outputField id="idApprovalRule" value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Assignee__c}" />  
                </apex:pageBlockSectionItem>

                <!-- step description -->
                <apex:pageBlockSectionItem >
                    <apex:outputLabel for="idStepDesc" value="{!$Label.apttus_approval__StepDescription}" />
                    <apex:outputField id="idStepDesc" value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Description__c}" />
                </apex:pageBlockSectionItem>

                <!-- active -->
                <!--<apex:pageBlockSectionItem rendered="{!isStepTypeSubprocess || isStepTypeChildProcess}">
                    <apex:outputLabel value="{!$ObjectType.Approval_Process__c.Fields.Step_Active__c.Label}" />
                    <apex:outputField value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__Step_Active__c}" />
                </apex:pageBlockSectionItem>-->
            </apex:pageBlockSection>

            <!-- Step Auto Reapproval Conditions -->
            <!-- TODO: don't show until we can add readOnly parameter to the component -->
            <!--<apex:pageBlockSection id="idStepAutoReapprovalInfo" 
                                   title="{!$Label.AutoReapprovalCriteria}" 
                                   columns="1" 
                                   collapsible="false"
                                   rendered="{!isStepTypeStandard}" >

                <c:UIReapprovalFilter id="idReapprovalFilter"  
                                      sObjectName="{!businessObjectType}"  
                                      pageController="{!this}" 
                                      mode="wizard" />
            </apex:pageBlockSection>-->

            <!-- Step Dependency Information -->
            <apex:pageBlockSection id="idStepBlockDependencyInfo" 
                                   title="{!$Label.apttus_approval__ApprovalProcessStepDependencyInfo}" 
                                   columns="1" 
                                   collapsible="false" >
                                   
                <c:UIDependsOn id="idDependsOn" 
                               pageControllerAttr="{!this}"
                               contextSOAttr="{!Apttus_Approval__Approval_Process__c}"
                               contextSOFieldAttr="DependsOn__c"
                               contextSOLabelAttr="Approval Process Step"
                               isReadOnlyAttr="true"
                               itemValuesAttr="{!dependsOnValues}" />
            </apex:pageBlockSection>

            <!-- Step Assignee Information -->
            <apex:pageBlockSection id="idStepBlockAssigneeInfo" 
                                   title="{!$Label.apttus_approval__ApprovalProcessStepAssigneeInfo}" 
                                   columns="1" 
                                   collapsible="false" 
                                   rendered="{!isStepTypeStandard}">

                <!-- assigned approvers -->
                <c:UIAssignee id="idAssigneeType" 
                              pageControllerAttr="{!this}"
                              contextSOAttr="{!Apttus_Approval__Approval_Process__c}"
                              contextSOLabelAttr="{!$ObjectType.Apttus_Approval__Approval_Process__c.Label}"
                              isReadOnlyAttr="true"
                              businessObjTypeAttr="{!businessObjectType}"
                              assigneeTypeFieldAttr="Step_Assignee_Type__c"
                              assigneeValueFieldAttr="Step_Assignee__c"
                              assigneeIdFieldAttr="Step_Assignee_Id__c"
                              assigneeDescFieldAttr="Step_Assignee_Description__c"
                              assigneeSendEmailFieldAttr="Send_Email__c"
                              assigneeNotifyOnlyFieldAttr="Step_Notify_Only__c"
                              assigneeAttr="{!assignee}"
                              supportedAssigneeTypesAttr="{!supportedAssigneeTypes}"
                              parentReRenderIdAttr="idApprovalProcessStepForm" />
            </apex:pageBlockSection>
            
            <!-- Step Escalation Assignee Information -->
            <apex:pageBlockSection id="idStepBlockEscalationAssigneeInfo" 
                                   title="{!$Label.apttus_approval__ApprovalProcessStepEscalationAssigneeInfo}" 
                                   columns="1" 
                                   collapsible="false"
                                   rendered="{!isStepTypeStandard}" >

                <apex:pageBlockSectionItem >
                    <apex:outputLabel for="idViewEscalationAutoEscalate" value="{!$ObjectType.Apttus_Approval__Approval_Process__c.Fields.Apttus_Approval__StepAutoEscalate__c.Label}" />
                    <apex:outputField id="idViewEscalationAutoEscalate" value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepAutoEscalate__c}" />
                </apex:pageBlockSectionItem>
    
                <apex:pageBlockSectionItem >
                    <apex:outputLabel for="idViewEscalationExpectedDaysToComplete" value="{!$ObjectType.Apttus_Approval__Approval_Process__c.Fields.Apttus_Approval__StepExpectedDaysToComplete__c.Label}" />
                    <apex:outputText id="idViewEscalationExpectedDaysToComplete" value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepExpectedDaysToComplete__c}" />
                </apex:pageBlockSectionItem>
    
                <apex:pageBlockSectionItem >
                    <apex:outputLabel for="idViewEscalationExpectedHoursToComplete" value="{!$ObjectType.Apttus_Approval__Approval_Process__c.Fields.Apttus_Approval__StepExpectedHoursToComplete__c.Label}" />
                    <apex:outputText id="idViewEscalationExpectedHoursToComplete" value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepExpectedHoursToComplete__c}" />
                </apex:pageBlockSectionItem>
    
                <!-- Assignee Escalation Settings -->
                <c:UIEscalationAssignee id="idEscalationAssigneeType" 
										pageControllerAttr="{!this}"
										contextSOAttr="{!Apttus_Approval__Approval_Process__c}"
										contextSOLabelAttr="{!$ObjectType.Apttus_Approval__Approval_Process__c.Label}"
										isReadOnlyAttr="true"
										businessObjTypeAttr="{!businessObjectType}"
										isAutoEscalateEnabledAttr="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepAutoEscalate__c}"
										assigneeTypeFieldAttr="StepEscalateToType__c"
										assigneeValueFieldAttr="StepEscalateToName__c"
										assigneeIdFieldAttr="StepEscalateToId__c"
                                        supportedAssigneeTypesAttr="{!supportedEscalationAssigneeTypes}"
										parentReRenderIdAttr="idApprovalProcessStepForm" />
            </apex:pageBlockSection>
            
            <!-- Step Submission Comments -->
            <apex:pageBlockSection columns="1" rendered="{!isReadOnly}">
                {!$Label.apttus_approval__ApprovalProcessStep6Inst}
            </apex:pageBlockSection>
                
            <apex:pageBlockSection id="idStepSubmissionCommentsSectionView" 
                                   title="{!$Label.apttus_approval__StepSubmissionCommentInfo}" 
                                   columns="1" 
                                   collapsible="false">

                <apex:pageBlockSectionItem rendered="{!isStepLevelSubmissionCommentsEnabled}">
                    <apex:outputLabel value="{!$ObjectType.Apttus_Approval__Approval_Process__c.Fields.Apttus_Approval__StepSubmissionCommentsEnabled__c.Label}" />
                    <apex:outputField value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepSubmissionCommentsEnabled__c}" />
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!isStepLevelSubmissionCommentsEnabled &&
                                                       numSubmissionCommentsPerStep >= 1}">
                    <apex:outputLabel value="{!$ObjectType.Apttus_Approval__Approval_Process__c.Fields.Apttus_Approval__StepSubmissionComment1Enabled__c.Label}" />
                    <apex:outputPanel id="idStepComment2EnabledPanel" layout="block" >
	                    <apex:outputField value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepSubmissionComment1Enabled__c}" />
	                    <apex:outputText >{!$Label[submissionComment1Label]}</apex:outputText>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!isStepLevelSubmissionCommentsEnabled &&
                                                       numSubmissionCommentsPerStep >= 2}">
                    <apex:outputLabel value="{!$ObjectType.Apttus_Approval__Approval_Process__c.Fields.Apttus_Approval__StepSubmissionComment2Enabled__c.Label}" />
                    <apex:outputPanel id="idStepComment2EnabledPanel" layout="block" >
	                    <apex:outputField value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepSubmissionComment2Enabled__c}" />
	                    <apex:outputText >{!$Label[submissionComment2Label]}</apex:outputText>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!isStepLevelSubmissionCommentsEnabled &&
                                                       numSubmissionCommentsPerStep == 3}">
                    <apex:outputLabel value="{!$ObjectType.Apttus_Approval__Approval_Process__c.Fields.Apttus_Approval__StepSubmissionComment3Enabled__c.Label}" />
                    <apex:outputPanel id="idStepComment3EnabledPanel" layout="block" >
	                    <apex:outputField value="{!Apttus_Approval__Approval_Process__c.Apttus_Approval__StepSubmissionComment3Enabled__c}" />
	                    <apex:outputText >{!$Label[submissionComment3Label]}</apex:outputText>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>
            
            <!-- Step Display Fields -->
            <apex:pageBlockSection id="idStepDisplayFields" 
                                   title="{!$Label.apttus_approval__Step & ' ' & $Label.apttus_approval__DisplayFields}" 
                                   columns="1" 
                                   collapsible="false" >

                <c:UIDisplayFieldNames rendered="{!(isStepTypeStandard || isStepTypeSubprocess)}"
                                       pageControllerAttr="{!this}"
                                       contextSOAttr="{!Apttus_Approval__Approval_Process__c}"
                                       contextSOFieldAttr="StepDisplayFieldNames__c"
                                       contextSOLabelAttr="{!businessObjectType}"
                                       isReadOnlyAttr="true"
                                       itemValuesAttr="{!displayFieldNameValues}" />

                <c:UIDisplayFieldNames rendered="{!isStepTypeChildProcess}"  
                                       pageControllerAttr="{!this}"
                                       contextSOAttr="{!Apttus_Approval__Approval_Process__c}"
                                       contextSOFieldAttr="StepDisplayFieldNames__c"
                                       contextSOLabelAttr="{!childObjectType}"
                                       isReadOnlyAttr="true"
                                       itemValuesAttr="{!displayFieldNameValues}" />
            </apex:pageBlockSection>
                                   
        </apex:pageBlock>
  
        <!-- Approval Step Entry Criteria -->
        <apex:pageBlock id="idStepFilterCriteriaBlock"
                        title="{!$Label.apttus_approval__ApprovalProcessStepFilterCriteria}"
                        rendered="{!IsViewMode && NOT(inSearchMode) && predicates.size > 0}">

            <apex:pageBlockSection columns="1" rendered="{!isReadOnly}">
                {!$Label.apttus_approval__ApprovalProcessStepFilterCriteriaInst}
            </apex:pageBlockSection>
                
            <apex:pageBlockSection id="idStepFilterCriteriaSectionView" 
                                   title="{!$Label.apttus_approval__ApprovalProcessStepFilterCriteria}" 
                                   columns="2" 
                                   collapsible="false">
                                   
                <apex:pageBlockTable value="{!predicates}" 
                                     var="predicate" 
                                     columns="11" 
                                     rowClasses="oddRow,evenRow">

                    <!-- 1. rownum -->
                    <apex:column rendered="{!isAdvancedOptionsMode}" >
                        <apex:outputText id="idRowNum" value="{!predicate.RowNum}. " />
                    </apex:column>
                    
                    <!-- 2. LHS child search filter name -->
                    <apex:column >
                        <apex:facet name="header">
                            <apex:outputText >{!$Label.apttus_approval__LHS} {!$Label.apttus_approval__Child}<br/>{!$Label.apttus_approval__Filter}</apex:outputText>
                        </apex:facet>
                        <apex:outputPanel rendered="{!predicate.UseLHSChildFilter}"
                                          styleClass="{!IF(predicate.FieldInError, 'errorRow', '')}" layout="block" >
                            <apex:selectList id="idLHSChildFilterName" size="1"
                                             value="{!predicate.LHSChildFilterName}"
                                             disabled="true">
                                <apex:selectOptions value="{!childSearchFilterItems}"></apex:selectOptions>
                                <apex:actionSupport event="onchange"
                                                    action="{!predicate.doLHSChildFilterNameChanged}"
                                                    reRender="idStepFilterCriteriaSectionEdit" 
                                                    status="idStatusWaitLHSChildFilterName" />
                            </apex:selectList>
                        </apex:outputPanel>
                    </apex:column>
                    
                    <!-- 3. LHS child object field -->
                    <apex:column >
                        <apex:facet name="header">
                            <apex:outputText >{!$Label.apttus_approval__LHS} {!$Label.apttus_approval__Child}<br/> {!$Label.apttus_approval__Filter} {!$Label.apttus_approval__Field}</apex:outputText>
                        </apex:facet>
                        <apex:outputPanel rendered="{!predicate.UseLHSChildFilter}"
                                          styleClass="{!IF(predicate.FieldInError, 'errorRow', '')}" layout="block" >
                            <apex:selectList id="idChildObjectField" size="1"
                                             value="{!predicate.FieldName}"
                                             disabled="true">
                                <apex:selectOptions value="{!predicate.LHSChildObjectFieldItems}"></apex:selectOptions>
                            </apex:selectList>
                        </apex:outputPanel>
                    </apex:column>
                    
                    <!-- 4. business object field -->
                    <apex:column headerValue="{!$Label.apttus_approval__Field}">
                        <apex:outputPanel styleClass="{!IF(predicate.FieldInError, 'errorRow', '')}" layout="block" >
                            <apex:selectList id="idBusObjectField"
                                             value="{!predicate.FieldName}"
                                             size="1"
                                             disabled="true">
                                <apex:selectOptions value="{!fieldItems}"></apex:selectOptions>
                            </apex:selectList>
                        </apex:outputPanel>
                    </apex:column>
                    
                    <!-- 5. operator -->
                    <apex:column headerValue="{!$Label.apttus_approval__Operator}">
                        <apex:outputPanel styleClass="{!IF(predicate.CompOperInError, 'errorRow', '')}" layout="block" >
                            <apex:selectList id="idCompOper"
                                             value="{!predicate.CompOper}" 
                                             size="1"
                                             disabled="true">
                                <apex:selectOptions value="{!compOperItems}"></apex:selectOptions>
                            </apex:selectList>
                        </apex:outputPanel>
                    </apex:column>

                    <!-- 6. RHS child search filter name -->
                    <apex:column >
                        <apex:facet name="header">
                            <apex:outputText >{!$Label.apttus_approval__RHS} {!$Label.apttus_approval__Child}<br/>{!$Label.apttus_approval__Filter}</apex:outputText>
                        </apex:facet>
                        <apex:outputPanel rendered="{!predicate.UseRHSChildFilter}"
                                          styleClass="{!IF(predicate.FieldInError, 'errorRow', '')}" layout="block" >
                            <apex:selectList id="idRHSChildFilterName" size="1"
                                             value="{!predicate.RHSChildFilterName}"
                                             disabled="true">
                                <apex:selectOptions value="{!childSearchFilterItems}"></apex:selectOptions>
                                <apex:actionSupport event="onchange"
                                                    action="{!predicate.doRHSChildFilterNameChanged}"
                                                    reRender="idStepFilterCriteriaSectionEdit" 
                                                    status="idStatusWaitRHSChildFilterName" />
                            </apex:selectList>
                        </apex:outputPanel>
                    </apex:column>

                    <!-- 7. RHS child object value -->
                    <apex:column >
                        <apex:facet name="header">
                            <apex:outputText >{!$Label.apttus_approval__RHS} {!$Label.apttus_approval__Child}<br/>{!$Label.apttus_approval__Filter} {!$Label.apttus_approval__Field}</apex:outputText>
                        </apex:facet>
                        <apex:outputPanel rendered="{!predicate.UseRHSChildFilter}"
                                          styleClass="{!IF(predicate.FieldInError, 'errorRow', '')}" layout="block" >
                            <apex:selectList id="idRHSChildObjectField" size="1"
                                             value="{!predicate.FieldValue}" 
                                             disabled="true">
                                <apex:selectOptions value="{!predicate.RHSChildObjectFieldItems}"></apex:selectOptions>
                            </apex:selectList>
                        </apex:outputPanel>
                    </apex:column>

                    <!-- 8. business object value -->
                    <apex:column headerValue="{!$Label.apttus_approval__Value}">
                        <apex:outputPanel styleClass="{!IF(predicate.FieldValueInError, 'errorRow', '')}"
                                          layout="block" >
                            <apex:outputText id="idFieldValue"
                                             value="{!predicate.FieldValue}" 
                                             rendered="{!NOT(predicate.UseCustomValue)}" />
                            <apex:outputText value="{!$Label.apttus_approval__NotApplicable}" 
                                             style="width:60px" 
                                             rendered="{!predicate.UseCustomValue}" />
                        </apex:outputPanel>
                    </apex:column>
                    
                    <!-- 9. custom -->
                    <apex:column headerValue="{!$Label.apttus_approval__Custom}">
                        <apex:outputPanel rendered="{!NOT(predicate.UseLHSChildFilter ||
                                                          predicate.UseRHSChildFilter)}">
                            <apex:inputCheckbox id="idUseCustomValue"
                                                value="{!predicate.UseCustomValue}"
                                                disabled="true">      
                            </apex:inputCheckbox>
                        </apex:outputPanel>
                    </apex:column>
                    
                    <!-- 10. custom value expression -->
                    <apex:column headerValue="{!$Label.apttus_approval__CustomValueExpression}">
                        <apex:pageBlockTable value="{!dummyItems}" 
                                             var="dummyItem" 
                                             columns="4"
                                             rowClasses="oddRow,evenRow"
                                             rendered="{!predicate.UseCustomValue}">
                                     
                            <apex:column headerValue="{!$Label.apttus_approval__Object}">
                                <apex:outputPanel styleClass="{!IF(predicate.FieldInError, 'errorRow', '')}" layout="block" >
                                    <apex:selectList id="idCustomValueObject"
                                                     value="{!predicate.customValueObject}"
                                                     size="1"
                                                     disabled="true">
                                        <apex:selectOptions value="{!predicate.customValueObjects}"></apex:selectOptions>
                                    </apex:selectList>
                                </apex:outputPanel>
                            </apex:column>
        
                            <apex:column headerValue="{!$Label.apttus_approval__Field}">
                                <apex:outputPanel styleClass="{!IF(predicate.FieldInError, 'errorRow', '')}" layout="block" >
                                    <apex:selectList id="idFieldValueField"
                                                     value="{!predicate.customValueObjectField}"
                                                     size="1"
                                                     disabled="true">
                                        <apex:selectOptions value="{!predicate.customValueObjectFields}"></apex:selectOptions>
                                    </apex:selectList>
                                </apex:outputPanel>
                            </apex:column>
        
                            <apex:column headerValue="{!$Label.apttus_approval__FilterExpression}" colspan="1" rowspan="3">
                                <apex:outputPanel >                            
                                    <apex:selectList id="idFilterExprField"
                                                     value="{!predicate.CustomValueObjectFilterField}"
                                                     size="1"
                                                     disabled="true" >
                                        <apex:selectOptions value="{!predicate.customValueObjectFields}"></apex:selectOptions>
                                    </apex:selectList>
                                    <br/>
                                    <apex:selectList id="idFilterExprCompOper"
                                                     value="{!predicate.CustomValueObjectFilterCompOper}"
                                                     size="1"
                                                     disabled="true">
                                        <apex:selectOptions value="{!customObjectCompOperItems}"></apex:selectOptions>
                                    </apex:selectList>
                                    <br/>
                                    <apex:selectList id="idFilterExprFieldValueBound"              
                                                     value="{!predicate.CustomValueObjectFilterValue}" 
                                                     rendered="{!predicate.BindCustomFilterValue}"
                                                     size="1"
                                                     disabled="true">
                                        <apex:selectOptions value="{!customObjectBindFieldItems}"></apex:selectOptions>
                                    </apex:selectList>
                                    <apex:outputText id="idFilterExprFieldValue"
                                                     value="{!predicate.CustomValueObjectFilterValue}" 
                                                     rendered="{!NOT(predicate.BindCustomFilterValue)}" />
                                </apex:outputPanel>
                            </apex:column>
        
                            <apex:column headerValue="{!$Label.apttus_approval__BindValue}">
                                <apex:outputPanel >
                                    <apex:inputCheckbox id="idFilterExprBindCustomFilterValue"
                                                        value="{!predicate.BindCustomFilterValue}"
                                                        disabled="true">      
                                    </apex:inputCheckbox>
                                </apex:outputPanel>
                            </apex:column>
                            
                        </apex:pageBlockTable>
                    </apex:column>

                    <!-- 11. join/add -->
                    <apex:column rendered="{!NOT(isAdvancedOptionsMode)}">        
                        <apex:outputText id="idBoolOper" 
                                         value="{!predicate.BoolOper}" 
                                         rendered="{!NOT(isAdvancedOptionsMode) && NOT(ISBLANK(predicate.BoolOper))}" />
                    </apex:column>

                </apex:pageBlockTable>
            </apex:pageBlockSection>

            <!-- Advanced Options -->
            <apex:pageBlockSection id="idStepFilterCriteriaAdvancedOptionsView"
                                   columns="1"
                                   collapsible="false"
                                   rendered="{!isAdvancedOptionsMode}" >
                                   
                <apex:outputPanel rendered="{!isAdvancedOptionsMode}">
                    <br/>
                    <apex:outputText value="{!$Label.apttus_approval__AdvancedFilterCondition}" />
                    <br/>
                    <apex:outputText id="idAdvancedOptions" value="{!advancedOptions}" />
                </apex:outputPanel>
            </apex:pageBlockSection>
        </apex:pageBlock>
            
        <!-- Step Assignee Search Components -->
        <apex:pageBlock id="idPageBlockSearch"
                        title="{!$Label.apttus_approval__EditApprovalProcessStep}"
                        rendered="{!inSearchMode}">

            <c:UISearchQueue id="idQueueSearch" 
                             pageControllerAttr="{!this}"
                             contextSOAttr="{!Apttus_Approval__Approval_Process__c}"
                             contextSOFieldAttr="Step_Assignee__c"
                             contextSOFieldIdAttr="Step_Assignee_Id__c"
                             parentReRenderIdAttr="idApprovalProcessStepForm"
                             rendered="{!isStepTypeStandard && isAssigneeTypeQueue && currentStep == 5}" />
    
            <c:UISearchRole id="idRoleSearch" 
                            pageControllerAttr="{!this}"
                            contextSOAttr="{!Apttus_Approval__Approval_Process__c}"
                            contextSOFieldAttr="Step_Assignee__c" 
                            contextSOFieldIdAttr="Step_Assignee_Id__c"
                            parentReRenderIdAttr="idApprovalProcessStepForm"
                            rendered="{!isStepTypeStandard && isAssigneeTypeRole && currentStep == 5}" />
    
            <!-- search rules for standard step types -->
            <c:UISearchRule id="idRuleSearchStdType" 
                            pageControllerAttr="{!this}"
                            contextSOAttr="{!Apttus_Approval__Approval_Process__c}"
                            contextSOFieldAttr="Step_Assignee__c"
                            contextSOFieldIdAttr="Step_Assignee_Id__c"
                            businessObjTypeAttr="{!businessObjectType}"
                            parentReRenderIdAttr="idApprovalProcessStepForm"
                            rendered="{!(isStepTypeStandard && isAssigneeTypeRule && currentStep == 5) ||
                                        (isStepTypeSubprocess && currentStep == 1)}" />
                            
            <!-- search rules for subprocess or child process step types -->
            <c:UISearchRule id="idRuleSearchChildType" 
                            pageControllerAttr="{!this}"
                            contextSOAttr="{!Apttus_Approval__Approval_Process__c}"
                            contextSOFieldAttr="Step_Assignee__c"
                            contextSOFieldIdAttr="Step_Assignee_Id__c"
                            businessObjTypeAttr="{!childObjectType}"
                            parentReRenderIdAttr="idApprovalProcessStepForm"
                            rendered="{!isStepTypeChildProcess && currentStep == 1}" />
                            
            <c:UISearchUser id="idUserSearch" 
                            pageControllerAttr="{!this}"
                            contextSOAttr="{!Apttus_Approval__Approval_Process__c}"
                            contextSOFieldAttr="Step_Assignee__c"
                            contextSOFieldIdAttr="Step_Assignee_Id__c"
                            parentReRenderIdAttr="idApprovalProcessStepForm"
                            rendered="{!isStepTypeStandard && isAssigneeTypeUser && currentStep == 5}" />

        </apex:pageBlock>

        <!-- Escalation Assignee Search Components -->
        <apex:pageBlock id="idPageBlockSearchEscalationAssignee"
                        title="{!$Label.apttus_approval__EditApprovalProcessStep}"
                        rendered="{!inSearchMode && isStepTypeStandard && currentStep == 6}">

            <c:UISearchQueue id="idEscalationQueueSearch" 
                             pageControllerAttr="{!this}"
                             contextSOAttr="{!Apttus_Approval__Approval_Process__c}"
                             contextSOFieldAttr="StepEscalateToName__c"
                             contextSOFieldIdAttr="StepEscalateToId__c"
                             parentReRenderIdAttr="idApprovalProcessStepForm"
                             rendered="{!isEscalationAssigneeTypeQueue}" />
    
            <c:UISearchRole id="idEscalationRoleSearch" 
                            pageControllerAttr="{!this}"
                            contextSOAttr="{!Apttus_Approval__Approval_Process__c}"
                            contextSOFieldAttr="StepEscalateToName__c"
                            contextSOFieldIdAttr="StepEscalateToId__c"
                            parentReRenderIdAttr="idApprovalProcessStepForm"
                            rendered="{!isEscalationAssigneeTypeRole}" />
    
            <c:UISearchRule id="idEscalationRuleSearch" 
                            pageControllerAttr="{!this}"
                            contextSOAttr="{!Apttus_Approval__Approval_Process__c}"
                            contextSOFieldAttr="StepEscalateToName__c"
                            contextSOFieldIdAttr="StepEscalateToId__c"
                            businessObjTypeAttr="{!businessObjectType}"
                            parentReRenderIdAttr="idApprovalProcessStepForm"
                            rendered="{!isEscalationAssigneeTypeRule}" />
                            
            <c:UISearchUser id="idEscalationUserSearch" 
                            pageControllerAttr="{!this}"
                            contextSOAttr="{!Apttus_Approval__Approval_Process__c}"
                            contextSOFieldAttr="StepEscalateToName__c"
                            contextSOFieldIdAttr="StepEscalateToId__c"
                            parentReRenderIdAttr="idApprovalProcessStepForm"
                            rendered="{!isEscalationAssigneeTypeUser}" />

        </apex:pageBlock>

        <!-- action functions -->
        <apex:actionFunction name="invokeDoPrevious" 
                             action="{!doPrevious}"
                             reRender="idApprovalProcessStepForm"
                             status="idPleaseWaitStatus" />
        
        <apex:actionFunction name="invokeDoNext" 
                             action="{!doNext}"
                             reRender="idApprovalProcessStepForm"
                             status="idPleaseWaitStatus" />
        
        <apex:actionFunction name="invokeDoSave" 
                             action="{!doSave}"
                             reRender="idApprovalProcessStepForm"
                             status="idPleaseWaitStatus" />

        <!-- action status -->
        <apex:actionStatus id="idPleaseWaitStatus"
                           onstart="onActionClick();"
                           onstop="onActionComplete();" />

    </apex:form>

</apex:page>